(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{359:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=g(a(517)),l=g(a(39)),n=g(a(518)),u=g(a(85)),o=g(a(248)),d=g(a(405)),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e},s=function(e,t,a){return t&&c(e.prototype,t),a&&c(e,a),e};function c(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}a(520),a(64),a(521),a(84),a(247),a(413);var f=g(a(1)),p=g(a(384)),m=g(a(464)),v=a(509),h=a(67),y=g(a(494));function g(e){return e&&e.__esModule?e:{default:e}}a(495),a(770);var b=d.default.Option,E=o.default.TextArea,w={labelCol:{xs:{span:24},sm:{span:2}},wrapperCol:{xs:{span:24},sm:{span:22}}},_={allowPasteImage:!0,image:!0,video:!1,audio:!1,validateFn:null,uploadFn:null},x="create",I=0,k=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(O,f.default.Component),s(O,[{key:"componentDidMount",value:function(){var e=(0,h.parseUrl)(location.search);"update"===e.type&&e.id?(document.title="更新资源 - 博客后台",x="update",I=e.id,this.initData(e.id)):(document.title="新建资源 - 博客后台",x="create",this.setState({loading:!1}))}},{key:"initData",value:function(e){var r=this;(0,v.getMovieDetail)(e).then(function(e){if(200===e.code){var t=e.data;r.props.form.setFieldsValue({name:t.name,type:t.type,cover:t.cover,tag:t.tag,director:t.director,actor:t.actor,desc:t.desc});var a=m.default.createEditorState(t.content);r.refs.editor.setValue(a)}else u.default.error(e.msg);r.setState({loading:!1})})}},{key:"submitSource",value:function(e){e.preventDefault();var t=this.props.form.getFieldsValue(),a=this.refs.editor.getValue();t.content=a.toHTML(),this.judgeParams(t)&&("create"===x?this.createSource(t):"update"===x&&(t.id=I,this.updateSource(t)))}},{key:"judgeParams",value:function(e){var t={name:"标题不能为空",type:"请给资源选一个类型",content:"文章内容不能为空",cover:"请上传封面"};for(var a in t){if(!e[a])return u.default.error(t[a]),!1;if("content"===a&&"<p></p>"===e[a])return u.default.error(t[a]),!1}return!0}},{key:"uploadImg",value:function(e){var t=e.file,a=t.status,r=t.response;"done"===a?r.success?this.props.form.setFieldsValue({cover:r.data.url}):u.default.error(r.msg):"error"===a&&u.default.error(e.file.name+" file upload failed.")}},{key:"uploadImage",value:function(t){var e=new FormData;e.append("files",t.file),(0,y.default)("source",e).then(function(e){e.success?t.success(e.data):u.default.error("图片上传失败，请稍后重试!")})}},{key:"createSource",value:function(e){var t=this;(0,v.addMovie)(e).then(function(e){200===e.code?(u.default.success("创建成功"),t.props.router.push("/admin/source")):u.default.error(e.msg)})}},{key:"updateSource",value:function(e){var t=this;(0,v.updateMovie)(e).then(function(e){200===e.code?(u.default.success("更新成功"),t.props.router.push("/admin/source")):u.default.error(e.msg)})}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator;return _.uploadFn=this.uploadImage,f.default.createElement("div",{className:"source_add_page_wrap"},f.default.createElement(p.default,{pathes:["资源","新增资源"]}),f.default.createElement("div",{className:"add_main_form"},f.default.createElement(n.default,i({},w,{onSubmit:this.submitSource}),f.default.createElement(n.default.Item,{label:"Title"},e("name",{rules:[{required:!0,message:"标题不能为空"}]})(f.default.createElement(o.default,{style:{width:400}}))),f.default.createElement(n.default.Item,{label:"类型"},e("type",{rules:[{required:!0,message:"请选择一个类型"}]})(f.default.createElement(d.default,{style:{width:200},placeholder:"请选择一个类型"},f.default.createElement(b,{value:"电影"},"电影"),f.default.createElement(b,{value:"美剧"},"美剧"),f.default.createElement(b,{value:"电视剧"},"电视剧"),f.default.createElement(b,{value:"纪录片"},"纪录片")))),f.default.createElement(n.default.Item,{label:"封面"},f.default.createElement("div",null,e("cover",{rules:[{required:!0,message:"请选择一个类型"}]})(f.default.createElement(o.default,{style:{width:600}})),f.default.createElement(r.default,{name:"file",onChange:this.uploadImg,action:"/api/upload/upload?type=source",showUploadList:!1},f.default.createElement(l.default,{style:{marginLeft:"2px"},type:"primary"},"上传")))),f.default.createElement(n.default.Item,{label:"标签"},e("tag")(f.default.createElement(o.default,{style:{width:450},placeholder:"以 / 分割"}))),f.default.createElement(n.default.Item,{label:"导演"},e("director")(f.default.createElement(o.default,{style:{width:400}}))),f.default.createElement(n.default.Item,{label:"演员"},e("actor")(f.default.createElement(o.default,{placeholder:"以 、 分割"}))),f.default.createElement(n.default.Item,{label:"简介"},e("desc")(f.default.createElement(E,null))),f.default.createElement(n.default.Item,null,f.default.createElement(m.default,{style:{border:"1px solid #eee",width:"853px",margin:"0 auto"},media:_,ref:"editor",excludeControls:["emoji"]})),f.default.createElement(n.default.Item,{wrapperCol:{span:24}},f.default.createElement(l.default,{type:"primary",htmlType:"submit"},"提交")))))}}]),O);function O(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,O);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(O.__proto__||Object.getPrototypeOf(O)).call(this,e));return t.state={loading:!0},t.submitSource=t.submitSource.bind(t),t.uploadImg=t.uploadImg.bind(t),t}t.default=n.default.create()(k)},770:function(e,t,a){var r=a(771);"string"==typeof r&&(r=[[e.i,r,""]]);var l={hmr:!0,transform:void 0,insertInto:void 0};a(24)(r,l);r.locals&&(e.exports=r.locals)},771:function(e,t,a){(e.exports=a(23)(!1)).push([e.i,".source_add_page_wrap {\n  width: 1000px;\n  border-radius: 8px;\n  padding: 20px;\n  box-shadow: rgba(80, 80, 80, 0.11) 0px 1px 3px 0px;\n  background: #fff;\n  margin: 20px auto;\n}\n.add_main_form {\n  width: 853px;\n  margin: 0 auto;\n}\n",""])}}]);